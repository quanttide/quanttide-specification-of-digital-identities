# 合作者

在我们的用户体系中，合作者的概念比较广泛，只要有限地拥有部分员工权限的用户都可以定义为合作者。包括：

- 课堂APP的内测用户。
- 数据服务项目等的外部参与者。
- 云厂商、科研合作者等外部合作者。

合作者应用主要通过维护白名单为合作者提供有限的访问权限。

## 白名单

白名单为合作者提供某一个API的访问权限。

特定员工拥有特定类型白名单用户的读写权限，鉴权时可以读白名单。

预置一些白名单规则，比如某一类白名单用户拥有某一类权限。即类似于Django默认的[RBAC0模型](http://www.woshipm.com/pd/1150093.html)的User-Role-Permission架构，基于DRF重新定制一下。

考虑到微服务体系下要明确到服务和API，需要微服务网格来解决这个问题。
北极星提供的功能是通过[服务发现](https://polarismesh.cn/zh/doc/使用指南/基本原理.html)的[获取路由规则](https://polarismesh.cn/zh/doc/接口文档/服务发现.html#服务发现)。
临时上线可以先手动维护。
架构难设计。

## 鉴权流程

我这里触发了一个明确需要服务注册和发现的场景。

业务背景是给鉴权服务增加一个白名单功能，用来给内测用户或者企业外部项目成员开放部分API的部分权限。

这里的大概角色有三个：资源服务（Resource Server，R）、鉴权服务（Auth Server，A）、服务网格（Service Mesh）

大概的流程是：

1. 资源服务注册到服务网格，R -> M
2. 鉴权服务通过服务发现拉取服务网格的路由规则，M -> A
3. 管理员设置权限，A->A
4. 资源服务向鉴权服务申请白名单鉴权，R->A->R

简化模型：

1. 手动在A中设置。
2. R向A发鉴权申请。
